<!DOCTYPE HTML>
<html>
  <head>
  </head>
  <body>
    <canvas id="canvas" width="719" height="478" style="background:url('newbg1.png') no-repeat"></canvas>
	
<script src="./ocanvas-2.2.1.min.js"></script>
    <script type="text/javascript">
	
	
	
//OCANVAS INSTANTIATION
var canvas = oCanvas.create({
	canvas: "#canvas"
    });	


// GLOBAL CONSTANTS
var ourCar;
var isPosReady=0;

//GLOBAL LISTS
var badCar=new Array();
var randomPos=[0,0,0];
var laneArray = new Array(3);
var laneVariables = {"laneSpeed": 50, "lanedy": 5, "laney": 110};
jumptest=0;

//HELPER FUNCTIONS
function changeSpeed(ds,dt){
	var limit=ourcar.ourspeed+ds;
	var changeSpeedInt=setInterval(function(){
			ourcar.ourspeed+=1;
			if(ourcar.ourspeed==limit)
				clearInterval(changeSpeedInt);
		}, (dt/ds));
}

function getRandomPos(){
	for(var i=0;i<=2;i++)
	{
     randomPos[i]=Math.floor((Math.random()*2));
	}
	//console.log(randomPos);
    isPosReady=1;
}

//INITIALISERS

function initCar(canvas){
	ourCar = canvas.display.image({
		x: 359.5,
		y: 350,
		origin: { x: "center", y: "center" },
		image: "car0.png",
		ourSpeed : 0,
		});
	canvas.addChild(ourCar);
	//alert('added');

}

function initTraffic(canvas){
//	console.log(canvas);
	var ddx=-350;
	for(i=0;i<3;i++)
	{
	if(randomPos[i]!=0)
	{
		badCar.push(getCar(ddx));
		//alert(badCar[badCar.length-1]);
		canvas.addChild(badCar[badCar.length-1]);
		badCar[badCar.length-1].animate({
								x: badCar[badCar.length-1].x+ddx,
								y: badCar[badCar.length-1].y+500,
								width: badCar[badCar.length-1].width+250,
								height:	badCar[badCar.length-1].height+146.57
								},
								{
									easing: "ease-in-quint",
									duration: 2000,
									callback:function(){
										canvas.removeChild(badCar.shift());}
								}
							);
		}	
	ddx+=350;
	}
	isPosReady=0;  

}
function initLanes(canvas){
		var lane1 = canvas.display.image({
			x: 359.5,
			y: laneVariables.laney,
			width: 0,
			height: 0,
			origin: { x: "center", y: "center" },
			image: "laner.png",});
		var lane2 = lane1.clone({});
		var lane3 = lane1.clone({});
		laneArray[0] = lane1;
		laneArray[1] = lane2;
		laneArray[2] = lane3;
		canvas.addChild(laneArray[0]);
		//canvas.addChild(laneArray[1]);
		//canvas.addChild(laneArray[2]);
		
}

//SPRITE GENERATORS

function getCar(ddx)
   {
    var carNum=parseInt(Math.random()*4);
    var x = canvas.display.image({
	x: 359.5,
	y: 120,
	origin: { x: "center", y: "center" },
	image: "car"+carNum+".png",
	height: 0.12,
	width: .12*2.05,
	dx:ddx,
   });
   return x;
   }

   
//GAME LOOP FUNCTIONS
function moveLanes(){
	

	
	
	laneVariables.laney+= laneVariables.lanedy;
	if(laneVariables.laney>410){
		laneVariables.laney=110;
	}
	
	laneArray[0].x= 359.5-(((laneArray.laney-110)/(410-110)*314.5))/2;
	laneArray[0].y= laneVariables.laney;
	laneArray[0].width= (laneVariables.laney-110)/(410-100)*314.5;
	laneArray[0].height= ((laneVariables.laney-110)/(410-100)*150);
//	console.log(laneArray[0].y)
	
}

function moveTraffic()
{
	for(var i=0;i<badCar.length;i++)
	{
	 
  
	}
}



//COLLISION HANDLERS 
function checkCollision()
{}
function onCollision()
{}



//MAIN GAME LOOP
canvas.setLoop(function(){
	moveTraffic();
	if(isPosReady)
		initTraffic(canvas);
	moveLanes();
}).start();
canvas.bind("keypress", function (e) {

	if(jumptest==0){
			var keys = e.keyCode;
			
			if (keys==32){
				jumptest=1;
				//speed-=100;
				
				ourCar.stop().animate({ y: ourCar.y-170}, {duration: 400,callback:function(){
					ourCar.animate({ y: ourCar.y+170} ,{easing: "ease-in-sine",duration: 400,callback:function(){
					jumptest=0;
					//speed+=100;
					}});
				}});
			}	
			////console.log(e);
			else if (keys==39 && ourCar.x<440){
				jumptest=1;
				move=1;
				ourCar.animate({rotation: 45,x: ourCar.x+120}, {duration: 50, callback:function(){
				
						ourCar.animate({rotation:0,x: ourCar.x+40}, {duration: 20,callback:function(){jumptest=0;move=0;}});
					
				}});
				
			}	
			else if(keys==37 && ourCar.x>220){
				jumptest=1;
                move=-1;
				ourCar.animate({rotation: -45,x: ourCar.x-120}, {duration: 50, callback:function(){
				
						ourCar.animate({rotation: 0,x: ourCar.x-40}, {duration: 20,callback:function(){jumptest=0;move=0;}});
					
				}});
				
				}
	}
});



//ONE TIME FUNCTIONS
initLanes(canvas);
initCar(canvas);
setInterval(getRandomPos,500);
//setInterval(function(){console.log(laneArray.length);},10);



    </script>
</body>

</html>



